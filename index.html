<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Accesso Domande</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.111/pdf.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  #domande { margin-top: 20px; }
  .domanda { margin-bottom: 15px; }
</style>
</head>
<body>

<h2>Inserisci il codice per accedere:</h2>
<input type="password" id="codice" placeholder="Codice segreto">
<button onclick="verificaCodice()">Accedi</button>

<div id="upload" style="display:none;">
  <h2>Carica il PDF delle domande:</h2>
  <input type="file" id="fileInput" accept="application/pdf">
  <button onclick="leggiPDF()">Leggi PDF</button>
</div>

<div id="domande"></div>

<script>
function verificaCodice() {
    const codice = document.getElementById('codice').value;
    if (codice === "13112005") {
        alert("Accesso consentito!");
        document.getElementById('upload').style.display = 'block';
    } else {
        alert("Codice errato. Accesso negato.");
    }
}

function leggiPDF() {
    const file = document.getElementById('fileInput').files[0];
    if (!file) {
        alert("Seleziona un file PDF!");
        return;
    }

    const fileReader = new FileReader();
    fileReader.onload = function() {
        const typedarray = new Uint8Array(this.result);

        pdfjsLib.getDocument(typedarray).promise.then(pdf => {
            let domande = [];
            let totalePagine = pdf.numPages;

            for (let i = 1; i <= totalePagine; i++) {
                pdf.getPage(i).then(page => {
                    page.getTextContent().then(content => {
                        let text = content.items.map(item => item.str).join("\n");
                        let lines = text.split("\n");
                        let domanda_corrente = null;
                        let opzioni = [];

                        lines.forEach(line => {
                            if (/^\d+\./.test(line.trim())) {
                                if (domanda_corrente) {
                                    domanda_corrente.opzioni = opzioni;
                                    domande.push(domanda_corrente);
                                    opzioni = [];
                                }
                                domanda_corrente = { testo: line.trim(), corretta: null };
                            } else if (/^[A-D]\s/.test(line.trim())) {
                                let opzione = line.trim();
                                if (opzione.includes("●") || opzione.includes("•")) {
                                    domanda_corrente.corretta = opzione[0];
                                    opzione = opzione.replace("●", "").replace("•", "").trim();
                                }
                                opzioni.push(opzione);
                            }
                        });

                        if (domanda_corrente) {
                            domanda_corrente.opzioni = opzioni;
                            domande.push(domanda_corrente);
                        }

                        // Mostra le domande
                        const container = document.getElementById("domande");
                        container.innerHTML = "";
                        domande.forEach((d, idx) => {
                            let div = document.createElement("div");
                            div.className = "domanda";
                            div.innerHTML = `<b>${idx+1}. ${d.testo}</b><br>${d.opzioni.map((o,i)=> String.fromCharCode(65+i)+": "+o).join("<br>")}<br><i>Corretta: ${d.corretta || "?"}</i>`;
                            container.appendChild(div);
                        });
                    });
                });
            }
        });
    };
    fileReader.readAsArrayBuffer(file);
}
</script>

</body>
</html>
